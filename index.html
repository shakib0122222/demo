<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile Viewer & Downloader</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6fb;
      color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 10px;
    }
    h1 {
      color: #1a73e8;
      margin-bottom: 10px;
    }
    p {
      max-width: 500px;
      text-align: center;
      font-size: 15px;
      margin-bottom: 25px;
    }
    .input-box {
      display: flex;
      flex-direction: row;
      width: 100%;
      max-width: 500px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    input {
      flex: 1;
      padding: 12px;
      border: none;
      font-size: 16px;
      outline: none;
    }
    button {
      background: #1a73e8;
      color: white;
      border: none;
      padding: 12px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background: #1669c1;
    }
    #status {
      margin-top: 20px;
      font-weight: bold;
      color: #444;
    }
    .result {
      margin-top: 30px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 20px;
      width: 100%;
      max-width: 500px;
    }
    .profile {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .profile img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
    }
    .profile-info {
      display: flex;
      flex-direction: column;
    }
    .download {
      margin-top: 15px;
      text-align: center;
    }
    .download a {
      text-decoration: none;
      background: #28a745;
      color: white;
      padding: 10px 18px;
      border-radius: 6px;
      font-weight: bold;
    }
    .download a:hover {
      background: #218838;
    }
  </style>
</head>
<body>
  <h1>Profile Viewer & Downloader</h1>
  <p>একটি পাবলিক প্রোফাইল বা কনটেন্টের URL দিন, তারপর নিচে ফলাফল ও ডাউনলোড লিংক দেখতে পাবেন।</p>

  <div class="input-box">
    <input type="text" id="url" placeholder="যেমন: https://facebook.com/example.profile">
    <button id="submitBtn">Submit</button>
  </div>

  <div id="status"></div>
  <div id="results" class="result" style="display:none;"></div>

  <script>
    const btn = document.getElementById('submitBtn');
    const statusDiv = document.getElementById('status');
    const resultDiv = document.getElementById('results');

    async function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

    btn.addEventListener('click', async () => {
      const url = document.getElementById('url').value.trim();
      if(!url){ alert("একটি URL দিন"); return; }

      statusDiv.textContent = "Submitting...";
      resultDiv.style.display = "none";
      resultDiv.innerHTML = "";

      try {
        // 1️⃣ Submit URL
        let res = await fetch('/api/submit', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({url})
        });
        let data = await res.json();

        if(!data.uuid){ 
          statusDiv.textContent = "Error submitting URL!";
          console.log(data);
          return;
        }

        let uuid = data.uuid;
        statusDiv.textContent = "Processing...";

        // 2️⃣ Poll for results
        let results = null;
        while(!results){
          await sleep(3000);
          let r = await fetch('/api/results', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({uuid})
          });
          let d = await r.json();
          if(d.loading){ 
            statusDiv.textContent = "Processing...";
            continue;
          }
          results = d.results;
        }

        statusDiv.textContent = "Done ✅";
        resultDiv.style.display = "block";

        // 3️⃣ Show profile + download link
        const profilePic = results?.image || results?.photo || "https://via.placeholder.com/80";
        const name = results?.name || "Unknown User";
        const downloadLink = results?.download || "#";

        resultDiv.innerHTML = `
          <div class="profile">
            <img src="${profilePic}" alt="Profile Photo">
            <div class="profile-info">
              <strong>${name}</strong>
              <small>${url}</small>
            </div>
          </div>
          <div class="download">
            <a href="${downloadLink}" target="_blank">Download</a>
          </div>
        `;
      } catch (err) {
        console.error(err);
        statusDiv.textContent = "❌ Error connecting to server.";
      }
    });
  </script>
</body>
</html>
